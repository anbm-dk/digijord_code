# Accuracy depending on the presence of bare soil
get_acc_bare <- function(i2) {
lookup <- c(obs = fractions[i2])
out <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
is.finite(pred),
is.finite(weights),
!is.na(depth)
) %>% group_by(indices, bare, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_bare <- foreach(i = 1:length(fractions), .combine = rbind) %do%
get_acc_bare(i)
acc_bare
write.table(
acc_bare,
paste0(dir_results, "/boot_acc_bare_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
acc_all
get_acc_lowsoc<- function(i2) {
lookup <- c(obs = fractions[i2])
out <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
obs <= 6,
is.finite(pred),
is.finite(weights),
!is.na(depth)
) %>% group_by(indices, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_lowsoc <- get_acc_lowsoc(5)
acc_lowsoc
write.table(
acc_lowsoc,
paste0(dir_results, "/boot_acc_lowsoc_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
finesand_dat <- data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]]
)
finesand_dat
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]]
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method"
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout"))
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
c(indices, depth, method)
)
rlang::last_trace()
?group_by
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
) %>%
summarise(
r2w = round(get_R2w(cbind(predicted, observed), w), digits = 3),
rmsew = round(get_RMSEw(cbind(predicted, observed), w), digits = 3)
)
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
) %>%
filter(is.na(depth))
finesand_acc <- data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
mean_d = min(mean_d, 200),
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
) %>%
summarise(
r2w = round(get_R2w(cbind(predicted, observed), w), digits = 3),
rmsew = round(get_RMSEw(cbind(predicted, observed), w), digits = 3)
)
finesand_acc
data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(
is.finite(observed)
) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
mean_d = min(c(mean_d, 200)),
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
) %>%
summarise(
r2w = round(get_R2w(cbind(predicted, observed), w), digits = 3),
rmsew = round(get_RMSEw(cbind(predicted, observed), w), digits = 3)
)
finesand_acc <- data.frame(
pred_model = fine_sand_model_mean,
pred_residual = boot_mean_predictions[, 3],
observed = obs$fine_sand,
dataset = obs$fold,
w = models_weights[[3]],
upper = obs$upper,
lower = obs$lower
) %>%
filter(is.finite(observed)) %>% mutate(
indices = factor(dataset == 10, labels = c("CV", "Holdout")),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
filter(is.finite(depth)) %>%
pivot_longer(
cols = c(pred_model, pred_residual),
names_to = "method",
values_to = "predicted"
) %>%
group_by(
indices, depth, method
) %>%
summarise(
r2w = round(get_R2w(cbind(predicted, observed), w), digits = 3),
rmsew = round(get_RMSEw(cbind(predicted, observed), w), digits = 3)
)
finesand_acc
write.table(
finesand_acc,
paste0(dir_results, "/boot_finesand_acc_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
obs$imputed
get_acc_lowsoc<- function(i2) {
lookup <- c(obs = fractions[i2])
out <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE),
imputed = obs$imputed
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
obs <= 6,
is.finite(pred),
is.finite(weights),
!is.na(depth),
imputed == FALSE
) %>% group_by(indices, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_lowsoc <- get_acc_lowsoc(5)
acc_lowsoc
write.table(
acc_lowsoc,
paste0(dir_results, "/boot_acc_lowsoc_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
get_acc_all <- function(i2) {
lookup <- c(obs = fractions[i2])
dat_i <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
is.finite(pred),
is.finite(weights),
!is.na(depth)
)
if (i2 == 5) {
dat_i %<>% filter(
imputed == FALSE
)
}
out <- dat_i %>% group_by(indices, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_all <- foreach(i = 1:length(fractions), .combine = rbind) %do%
get_acc_all(i)
acc_all
write.table(
acc_all,
paste0(dir_results, "/boot_acc_all_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
get_acc_bare <- function(i2) {
lookup <- c(obs = fractions[i2])
out <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
is.finite(pred),
is.finite(weights),
!is.na(depth),
imputed == FALSE
) %>% group_by(indices, bare, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_bare <- foreach(i = 1:length(fractions), .combine = rbind) %do%
get_acc_bare(i)
acc_bare
write.table(
acc_bare,
paste0(dir_results, "/boot_acc_bare_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
get_acc_bare <- function(i2) {
lookup <- c(obs = fractions[i2])
dat_i <- obs %>%
mutate(
pred = boot_mean_predictions[, i2],
weights = models_weights[[i2]],
indices = factor(!models_indices[[i2]], labels = c("CV", "Holdout")),
bare = obs$s2_count_max10_fuzzy > 0,
bare = case_when(
is.na(bare) ~ 0,
.default = bare
),
mean_d = (upper + lower)/2,
depth = cut(mean_d, breaks, include.lowest = TRUE)
) %>%
rename(any_of(lookup)) %>%
filter(
is.finite(obs),
is.finite(pred),
is.finite(weights),
!is.na(depth),
imputed == FALSE
)
if (i2 == 5) {
dat_i %<>% filter(
imputed == FALSE
)
}
out <- dat_i %>% group_by(indices, depth) %>%
summarise(
r2 = round(get_R2w(cbind(pred, obs), weights), digits = 3),
rmse = round(get_RMSEw(cbind(pred, obs), weights), digits = 3)
) %>%
mutate(Fraction = fraction_names[i2], .before = everything())
return(out)
}
acc_bare <- foreach(i = 1:length(fractions), .combine = rbind) %do%
get_acc_bare(i)
acc_bare
write.table(
acc_bare,
paste0(dir_results, "/boot_acc_bare_test", testn, ".csv"),
sep = ";",
row.names = FALSE
)
