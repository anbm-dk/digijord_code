ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0)) +
facet_wrap(
~ fraction,
ncol = 3
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0)) +
facet_wrap(
~ fraction,
ncol = 3,
labeller = label_parsed()
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0)) +
facet_wrap(
~ fraction,
ncol = 3,
labeller = label_parsed
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
ndir_plot <- 64
imp_ogc <- l %>%
select(fraction, Covariate, rep, Importance) %>%
filter(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)) %>%
arrange(Covariate) %>%
mutate(
dir = substr(
Covariate,
nchar(Covariate) - 2,
nchar(Covariate)
) %>%
as.numeric() %>%
"*" (ndir_plot) %>%
"/" (1000) %>%
"+" (1) %>%
round(digits = 0)
) %>%
group_by(fraction, rep) %>%
mutate(
# Importance = Importance/sum(Importance),
Importance = Importance/max(Importance),
Importance = case_when(
!is.finite(Importance) ~ 0,
.default = Importance
)
)
imp_ogc2 <- imp_ogc %>%
mutate(dir = dir + ndir_plot)
imp_ogc %<>% bind_rows(., imp_ogc2)
brks <- seq(
from = min(imp_ogc$dir),
by = (max(imp_ogc$dir) + 1 - min(imp_ogc$dir))/4,
length.out = 4
)
imp_ogc %>%
ggplot(aes(x = dir, y = Importance)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_point() +
facet_wrap(
~ fraction,
ncol = 3
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0)) +
facet_wrap(
~ fraction,
ncol = 3,
labeller = label_parsed
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
ndir_plot <- 64
imp_ogc <- l %>%
select(fraction, Covariate, rep, Importance) %>%
filter(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)) %>%
arrange(Covariate) %>%
mutate(
dir = substr(
Covariate,
nchar(Covariate) - 2,
nchar(Covariate)
) %>%
as.numeric() %>%
"*" (ndir_plot) %>%
"/" (1000) %>%
"+" (1) %>%
round(digits = 0)
) %>%
group_by(fraction, rep) %>%
mutate(
Importance = Importance/sum(Importance),
Importance = case_when(
!is.finite(Importance) ~ 0,
.default = Importance
)
)
imp_ogc2 <- imp_ogc %>%
mutate(dir = dir + ndir_plot)
imp_ogc %<>% bind_rows(., imp_ogc2)
brks <- seq(
from = min(imp_ogc$dir),
by = (max(imp_ogc$dir) + 1 - min(imp_ogc$dir))/4,
length.out = 4
)
imp_ogc %>%
ggplot(aes(x = dir, y = Importance)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_point() +
facet_wrap(
~ fraction,
ncol = 3
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
tiff(
paste0(dir_results, "/boot_importance_ogc_new_test", testn, ".tiff"),
width = 16,
height = 10,
units = "cm",
res = 600
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0)) +
facet_wrap(
~ fraction,
ncol = 3,
labeller = label_parsed
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
try(dev.off())
tiff(
paste0(dir_results, "/boot_importance_ogc_new_test", testn, ".tiff"),
width = 16,
height = 10,
units = "cm",
res = 600
)
imp_ogc %>%
ungroup() %>%
group_by(fraction, dir) %>%
summarise(
mean = mean(Importance),
q = quantile(Importance, probs = 0.75)
) %>%
ggplot(aes(x = dir, y = mean)) +
coord_polar(
start = - pi/2 - pi/(ndir_plot*2),
direction = -1) +
geom_linerange(aes(ymax = mean, ymin = 0), lineend = "round") +
facet_wrap(
~ fraction,
ncol = 3,
labeller = label_parsed
) +
scale_x_continuous(
breaks = brks,
labels = c('E', 'N', 'W', 'S')
) +
ylab('Covariate importance') +
theme(
axis.title.x = element_blank()
)
try(dev.off())
l %>%
select(fraction, Covariate, rep, Importance)
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, rep) %>%
summarise(sum = sum(Importance))
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance))
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(Importance)
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(mean)
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(-mean)
l %>%
select(fraction, Covariate, rep, Importance) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(-mean) %>%
slice_head(n = 10)
l %>%
select(fraction, Covariate, rep, Importance) %>%
filter(!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE))) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(-mean) %>%
slice_head(n = 10)
l %>%
select(fraction, Covariate, rep, Importance) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
(Covariate %in% c("upper", "lower"))
) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(-mean) %>%
slice_head(n = 10)
l %>%
select(fraction, Covariate, rep, Importance) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower"))
) %>%
group_by(fraction, Covariate) %>%
summarise(mean = mean(Importance)) %>%
arrange(-mean) %>%
slice_head(n = 10)
l
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower"))
) %>%
group_by(Covariate) %>%
summarise(mean = mean(Importance))
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower"))
) %>%
group_by(Covariate, category) %>%
summarise(mean = mean(Importance))
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower"))
) %>%
group_by(Covariate, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(category)
arrange(-mean) %>%
slice_head(n = 3)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower"))
) %>%
group_by(Covariate, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(category) %>%
arrange(-mean) %>%
slice_head(n = 3)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(category) %>%
arrange(-mean) %>%
slice_head(n = 3)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
arrange(-mean) %>%
slice_head(n = 10)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction) %>%
arrange(-mean) %>%
slice_head(n = 3)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction, category) %>%
arrange(-mean) %>%
slice_head(n = 2)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction, category) %>%
arrange(-mean) %>%
slice_head(n = 2) %>%
print(n = 100)
?make.names
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction, category) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction, category) %>%
arrange(-mean) %>%
slice_head(n = 2) %>%
mutate(
fraction = make.names(fraction),
category = make.names(category)
) %>%
print(n = 100)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction) %>%
arrange(-mean) %>%
slice_head(n = 10) %>%
mutate(
fraction = make.names(fraction),
category = make.names(category)
) %>%
print(n = 100)
l %>%
select(fraction, Covariate, rep, Importance, category) %>%
filter(
!(Covariate %in% grep('ogc_pi', Covariate, value = TRUE)),
!(Covariate %in% c("upper", "lower", "SOM_removed"))
) %>%
group_by(Covariate, fraction) %>%
summarise(mean = mean(Importance)) %>%
ungroup() %>%
group_by(fraction) %>%
arrange(-mean) %>%
slice_head(n = 10) %>%
mutate(
fraction = make.names(fraction)
) %>%
print(n = 100)
library(terra)
library(magrittr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(tidyterra)
library(sf)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
testn <- 14
mycrs <- "EPSG:25832"
dir_results <- dir_dat %>%
paste0(., "/results_test_", testn, "/")
obs <- paste0(dir_results, "/observations_texture.rds") %>%
readRDS()
mask_LU <- paste0(dir_dat, "/layers/Mask_LU.tif") %>% rast()  # reference
raster3km <- terra::aggregate(mask_LU, fact = 300, fun = "max")
coastline <- paste0(dir_dat, "/layers/Kyst/Kyst.shp") %>%
st_read() %>%
st_set_crs(mycrs)
# base_gg <- ggplot() +
#   geom_sf(data = coastline, fill = "grey", linewidth = 0, color = NA)
base_gg <- ggplot() +
geom_sf(data = coastline, fill = NA, linewidth = 0.5, color = "black")
obs_v <- obs %>%
vect(geom = c("UTMX", "UTMY"), crs = mycrs, keepgeom = TRUE) %>%
filter(imputed == FALSE)
obs_v %>% filter(upper > 60) %>% plot("CaCO3")
obs_v %>% filter(upper > 60, CaCO3 > 0) %>% plot("CaCO3")
