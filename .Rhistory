# Write files
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/") %T>%
dir.create()
write.table(
dsc2,
paste0(dir_obs_proc, "dsc.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
seges2,
paste0(dir_obs_proc, "seges.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
sinks4,
paste0(dir_obs_proc, "SINKS.csv"),
row.names = FALSE,
sep = ";"
)
# END
library(terra)
library(magrittr)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
mycrs <- "EPSG:25832"
# 1 Load observations
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/")
dsc <- dir_obs_proc %>%
paste0(., "dsc.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SEGES <- dir_obs_proc %>%
paste0(., "SEGES.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SINKS <- dir_obs_proc %>%
paste0(., "SINKS.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
cov_dir <- dir_dat %>% paste0(., "/covariates")
cov_files <- cov_dir %>% list.files
cov <- paste0(cov_dir, "/", cov_files) %>%
rast()
cov
names(cov)
cov_names <- cov_files %>% tools::file_path_sans_ext()
crs(cov) <- mycrs
cov
cov_dir <- dir_dat %>% paste0(., "/covariates")
cov_files <- cov_dir %>% list.files
cov_names <- cov_files %>% tools::file_path_sans_ext()
cov <- paste0(cov_dir, "/", cov_files) %>%
rast()
names(cov) <- cov_names
crs(cov) <- mycrs
names(cov)
cov
?extract
library(terra)
library(magrittr)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
mycrs <- "EPSG:25832"
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/")
dsc <- dir_obs_proc %>%
paste0(., "dsc.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SEGES <- dir_obs_proc %>%
paste0(., "SEGES.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SINKS <- dir_obs_proc %>%
paste0(., "SINKS.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
cov_dir <- dir_dat %>% paste0(., "/covariates")
cov_files <- cov_dir %>% list.files
cov_names <- cov_files %>% tools::file_path_sans_ext()
cov <- paste0(cov_dir, "/", cov_files) %>%
rast()
names(cov) <- cov_names
crs(cov) <- mycrs
cov
dsc_extr <- dsc %>%
extract(
cov,
.,
ID = FALSE,
)
dsc_extr <- dsc %>%
terra::extract(
x = cov,
y = .,
ID = FALSE,
)
dsc_extr
# Extract covariates
library(terra)
library(magrittr)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
mycrs <- "EPSG:25832"
# 1 Load observations
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/")
dsc <- dir_obs_proc %>%
paste0(., "dsc.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SEGES <- dir_obs_proc %>%
paste0(., "SEGES.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SINKS <- dir_obs_proc %>%
paste0(., "SINKS.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
# 2 Load covariates
cov_dir <- dir_dat %>% paste0(., "/covariates")
cov_files <- cov_dir %>% list.files
cov_names <- cov_files %>% tools::file_path_sans_ext()
cov <- paste0(cov_dir, "/", cov_files) %>%
rast()
names(cov) <- cov_names
crs(cov) <- mycrs
# 3 Extract
dsc_extr <- extract(
x = cov,
y = dsc,
ID = FALSE,
)
dsc_extr <- terra::extract(
x = cov,
y = dsc,
ID = FALSE,
)
sessionInfo()
install.packages("Rcpp")
install.packages("Rcpp")
install.packages("Rcpp")
library(terra)
library(magrittr)
sessionInfo()
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
mycrs <- "EPSG:25832"
# 1 Load observations
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/")
dsc <- dir_obs_proc %>%
paste0(., "dsc.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SEGES <- dir_obs_proc %>%
paste0(., "SEGES.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SINKS <- dir_obs_proc %>%
paste0(., "SINKS.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
# 2 Load covariates
cov_dir <- dir_dat %>% paste0(., "/covariates")
cov_files <- cov_dir %>% list.files
cov_names <- cov_files %>% tools::file_path_sans_ext()
cov <- paste0(cov_dir, "/", cov_files) %>%
rast()
names(cov) <- cov_names
crs(cov) <- mycrs
small_extr <- dsc_extr <- terra::extract(
x = cov,
y = dsc[1:100],
ID = FALSE,
)
small_extr
rm(small_extr)
rm(dsc_extr)
dsc_extr <- terra::extract(
x = cov,
y = dsc,
ID = FALSE,
)
SEGES_extr <- terra::extract(
x = cov,
y = SEGES,
ID = FALSE,
)
SINKS_extr <- terra::extract(
x = cov,
y = SINKS,
ID = FALSE,
)
# 4 Write to file
dir_extr <- dir_dat %>%
paste0(., "/extracts/")
write.table(
dsc_extr,
paste0(dir_extr, "dsc_extr.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
SEGES_extr,
paste0(dir_extr, "SEGES_extr.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
SINKS_extr,
paste0(dir_extr, "SINKS_extr.csv"),
row.names = FALSE,
sep = ";"
)
bind_rows(dsc, SEGES, SINKS)
library(dplyr)
bind_rows(dsc, SEGES, SINKS)
bind_rows(values(dsc), values(SEGES), values(SINKS))
bind_rows(dsc_extr, SEGES_extr, SINKS_extr)
library(Cubist)
library(terra)
library(magrittr)
library(raster)
library(tools)
library(dplyr)
library(caret)
library(tibble)
library(tidyr)
library(doParallel)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
testn <- 5
?read.table
cov_dir <- dir_dat %>% paste0(., "/covariates")
# 04: Create folds
library(terra)
library(magrittr)
dir_code <- getwd()
root <- dirname(dir_code)
dir_dat <- paste0(root, "/digijord_data/")
mycrs <- "EPSG:25832"
# 1 Load observations
dir_obs_proc <- dir_dat %>%
paste0(., "/observations/processed/")
dsc <- dir_obs_proc %>%
paste0(., "dsc.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SEGES <- dir_obs_proc %>%
paste0(., "SEGES.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
SINKS <- dir_obs_proc %>%
paste0(., "SINKS.csv") %>%
read.table(
header = TRUE,
sep = ";",
) %>%
vect(
geom = c("UTMX", "UTMY"),
crs = mycrs,
keepgeom = TRUE
)
# Load DEM
cov_dir <- dir_dat %>% paste0(., "/covariates")
# END
cov_dir <- dir_dat %>% paste0(., "/covariates/")
DEM_10m <- cov_dir %>%
paste0(., "/dhm2015_terraen_10m.tif") %>%
rast()
?aggregate
dir_folds <- dir_dat %>%
paste0(., "/folds/") %T>%
dir.create()
cov_dir <- dir_dat %>% paste0(., "/covariates/")
DEM_10m <- cov_dir %>%
paste0(., "/dhm2015_terraen_10m.tif") %>%
rast()
fun_agg <- function(x) {
out <- sum(!is.na(x)) == 0
return(out)
}
dir_folds <- dir_dat %>%
paste0(., "/folds/") %T>%
dir.create()
file_dem_mask_100m <- paste0(dir_folds, "/dem_mask_100m.tif/")
terra::aggregate(
DEM_10m,
10,
fun = fun_agg,
cores = 19,
filename = file_dem_mask_100m
)
file_dem_mask_100m
file_dem_mask_100m <- paste0(dir_folds, "/dem_mask_100m.tif")
terra::aggregate(
DEM_10m,
10,
fun = fun_agg,
cores = 19,
filename = file_dem_mask_100m
)
dem_mask_100m <- rast(file_dem_mask_100m)
dem_mask_100m2 <- ifel(dem_mask_100m == 1, 1, NA)
dem_mask_100m2
plot(dem_mask_100m2)
?ifel
plot(dem_mask_100m)
dem_mask_100m2 <- ifel(dem_mask_100m == 1, NA, 1)
dem_mask_100m2 <- ifel(dem_mask_100m == 1, NA, 1)
plot(dem_mask_100m2)
file_dem_mask_100m_2 <- paste0(dir_folds, "/dem_mask_100m_2.tif")
writeRaster(
dem_mask_100m2,
filename = file_dem_mask_100m_2
)
?writeRaster
writeRaster(
dem_mask_100m2,
filename = file_dem_mask_100m_2,
overwrite = TRUE,
datatype = "INT1U"
)
dem_mask_100m2 <- rast(file_dem_mask_100m_2)
plot(dem_mask_100m2)
?app
?sample.int
folds_10_100m <- app(
dem_mask_100m2,
function(x) {
out <- x*sample.int(10, 1)
return(out)
}
)
plot(folds_10_100m)
folds_10_100m <- app(
dem_mask_100m2,
function(x) {
out <- x*0 + sample.int(10, 1)
return(out)
}
)
folds_10_100m
folds_10_100m <- app(
dem_mask_100m2,
function(x) {
out <- x*0 + sample.int(10, 1)
return(out)
},
cores = 2
)
plot(folds_10_100m)
set.seed(1)
folds_10_100m <- app(
dem_mask_100m2,
function(x) {
out <- x*0 + sample.int(10, 1)
return(out)
},
cores = 2
)
plot(folds_10_100m)
file_folds_10_100m <- paste0(dir_folds, "/folds_10_100m.tif")
writeRaster(
folds_10_100m,
filename = file_folds_10_100m,
overwrite = TRUE,
datatype = "INT1U"
)
folds_10_100m <- rast(file_folds_10_100m)
dsc_folds <- terra::extract(
x = folds_10_100m,
y = dsc,
ID = FALSE,
)
SEGES_folds <- terra::extract(
x = folds_10_100m,
y = SEGES,
ID = FALSE,
)
SINKS_folds <- terra::extract(
x = folds_10_100m,
y = SINKS,
ID = FALSE,
)
# 5 Write to file
write.table(
dsc_folds,
paste0(dir_folds, "/dsc_folds.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
SEGES_folds,
paste0(dir_folds, "/SEGES_folds.csv"),
row.names = FALSE,
sep = ";"
)
write.table(
SINKS_folds,
paste0(dir_folds, "/SINKS_folds.csv"),
row.names = FALSE,
sep = ";"
)
