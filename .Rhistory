HUMUS = case_when(
PROFILNR == 2532 & HORISONTNR == 3 ~ 2.66,
.default = HUMUS
)
)
profiles_tex4 %<>%
rowwise() %>%
mutate(
TEKTURSUM = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, HUMUS, CACO3,
na.rm = TRUE)
) %>%
ungroup() %>%
mutate(
TEKTURSUM = case_when(
TEKTURSUM == 0 ~ NA,
.default = TEKTURSUM
)
)
# Export corrected table
profiles_analyse_corrected <- profiles_tex4 %>%
select(colnames(profiles_texture))
write.table(
profiles_analyse_corrected,
paste0(dir_dat, "/observations/profiles/ANALYSE_corrected_20230606.csv"),
sep = ";",
na = "",
row.names = FALSE
)
profiles_horizons_small <- profiles_horizons %>%
mutate(
HOR_ID = paste0(PROFILNR, "_", HORISONTNR)
) %>%
select(-c(PROFILNR, HORISONTNR, HORISONT))
profiles_tex5 <- profiles_analyse_corrected %>%
mutate(
PRFRA = case_when(
is.na(PRFRA) ~ PRTIL,
.default = PRFRA
),
PRTIL = case_when(
is.na(PRTIL) ~ PRFRA,
.default = PRTIL
)
) %>%
mutate(
HOR_ID = paste0(PROFILNR, "_", HORISONTNR)
) %>%
left_join(
profiles_horizons_small,
"HOR_ID"
) %>%
mutate(
PRFRA = case_when(
is.na(PRFRA) ~ FRA,
.default = PRFRA
),
PRTIL = case_when(
is.na(PRTIL) ~ TIL,
.default = PRTIL
)
) %>%
select(-c(HOR_ID, FRA, TIL))
profiles_tex5 %>% as.data.frame()
plot(is.na(profiles_tex5$HUMUS))
plot(is.na(profiles_tex5$HUMUS) & !is.na(profiles_tex5$LER))
profiles_tex5 %>% filter(is.na(HUMUS) & !is.na(LER))
profiles_tex5 %>% filter(is.na(HUMUS) & !is.na(LER)) %>% as.data.frame(
)
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
clay = Ler * 100 / (Ler + Silt + FinSD + GrovSD),
silt = Silt * 100 / (Ler + Silt + FinSD + GrovSD),
fine_sand = FinSD * 100 / (Ler + Silt + FinSD + GrovSD),
coarse_sand = GrovSD * 100 / (Ler + Silt + FinSD + GrovSD),
SOC = Humus*0.587,
SOM_removed = 0,
CaCO3_test = as.numeric(CaCO3 > 0)
) %>%
select(any_of(mycolnames))
profiles_tex5 %>% filter(is.na(HUMUS) & !is.na(LER)) %>% as.data.frame()
plot(profiles_tex5$TEKTURSUM)
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS)])
plot(profiles_tex5$`TOTAL KULSTOF`[is.na(profiles_tex5$HUMUS)])
profiles_tex5 %>% filter(TEKTURSUM > 90 & TEKTURSUM < 99)
profiles_tex5 %>% filter(TEKTURSUM > 90 & TEKTURSUM < 99) %>% as.data.frame()
profiles_tex5 %>% filter(TEKTURSUM > 80 & TEKTURSUM < 90) %>% as.data.frame()
profiles_tex5 %>% filter(TEKTURSUM > 80 & TEKTURSUM < 90 & !is.na(LER)) %>% as.data.frame()
plot(profiles_tex5$`LER`[is.na(profiles_tex5$HUMUS)])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS)])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS) & is.na(profiles_tex5$CACO3)])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS) & profiles_tex5$CACO3 > 0])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS) & profiles_tex5$CACO3 == 0])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS) & is.na(profiles_tex5$CACO3)])
plot(profiles_tex5$TEKTURSUM[is.na(profiles_tex5$HUMUS) & profiles_tex5$CACO3 == 0])
profiles_tex5 %>%
filter(!is.na(LER)) %>%
filter(TEKTURSUM < 99) %>%
filter(is.na(HUMUS))
profiles_tex5 %>%
filter(!is.na(LER)) %>%
filter(TEKTURSUM < 99) %>%
filter(is.na(HUMUS)) %>%
as.data.frame()
profiles_tex5 %>%
filter(!is.na(LER)) %>%
filter(TEKTURSUM < 99) %>%
filter(is.na(HUMUS)) %>%
filter(is.na(CACO3))
as.data.frame()
profiles_tex5 %>%
filter(!is.na(LER)) %>%
filter(TEKTURSUM < 99) %>%
filter(is.na(HUMUS)) %>%
filter(is.na(CACO3)) %>% as.data.frame()
as.data.frame()
profiles_tex5 %>%
filter(!is.na(LER)) %>%
filter(TEKTURSUM < 99) %>%
filter(is.na(HUMUS)) %>%
filter(is.na(CACO3)) %>%
slice_sample(n = 20) %>%
as.data.frame()
profiles_tex5 %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CaCO3)
) %>%
ggplot(aes(x = tminsum, y = not_SOM_CaCO3)) + geom_point()
profiles_tex5 %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CACO3)
) %>%
ggplot(aes(x = tminsum, y = not_SOM_CaCO3)) + geom_point()
profiles_tex5 %>%
filter(TEKTURSUM < 99)
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CACO3)
) %>%
ggplot(aes(x = tminsum, y = not_SOM_CaCO3)) + geom_point()
profiles_tex5 %>%
filter(TEKTURSUM < 99) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CACO3)
) %>%
ggplot(aes(x = tminsum, y = not_SOM_CaCO3)) + geom_point()
profiles_tex5 %>%
filter(TEKTURSUM < 99) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CACO3)
) %>%
ggplot(aes(x = TEKTURSUM, y = not_SOM_CaCO3)) + geom_point()
profiles_tex5 %>%
filter(TEKTURSUM < 99) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = 100 - (HUMUS + CACO3)
) %>%
ggplot(aes(x = TEKTURSUM, y = tminsum)) + geom_point()
plot(is.na(profiles_tex5$TEKTURSUM))
100 - NA
c(1,2,3) + c(1,2,3)
c(1:10) > 5
c(1:10; NA) > 5
c(1:10, NA) > 5
c(1:11)[c(1:10, NA) > 5]
c(1:11)[c(1:10, NA) > 5 & !is.na(c(1:10, NA))]
v <- c(1:10)
v[c(1, NA)]
v[c(1, NA)] <- 11
v
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0.
.default = NA
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0,
.default = NA
),
CaCO3 = CACO3
) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
),
clay = case_when(
TEKTURSUM >= 90 ~ LER * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ LER * 100 / (not_SOM_CaCO3),
.default = LER
),
silt = case_when(
TEKTURSUM >= 90 ~ SILT * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ SILT * 100 / (not_SOM_CaCO3),
.default = SILT
),
fsand_raw = sum(GRVSILT, S63, S125, na.rm = TRUE),
fine_sand = case_when(
TEKTURSUM >= 90 ~ fsand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ fsand_raw * 100 / (not_SOM_CaCO3),
.default = fsand_raw
),
csand_raw = sum(S200, S500, na.rm = TRUE),
coarse_sand = case_when(
TEKTURSUM >= 90 ~ csand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ csand_raw * 100 / (not_SOM_CaCO3),
.default = csand_raw
)
)%>%
select(any_of(mycolnames))
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0,
.default = NA
),
CaCO3 = CACO3
) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
),
clay = case_when(
TEKTURSUM >= 90 ~ LER * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ LER * 100 / (not_SOM_CaCO3),
.default = LER
),
silt = case_when(
TEKTURSUM >= 90 ~ SILT * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ SILT * 100 / (not_SOM_CaCO3),
.default = SILT
),
fsand_raw = sum(GRVSILT, S63, S125, na.rm = TRUE),
fine_sand = case_when(
TEKTURSUM >= 90 ~ fsand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ fsand_raw * 100 / (not_SOM_CaCO3),
.default = fsand_raw
),
csand_raw = sum(S200, S500, na.rm = TRUE),
coarse_sand = case_when(
TEKTURSUM >= 90 ~ csand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ csand_raw * 100 / (not_SOM_CaCO3),
.default = csand_raw
)
)%>%
select(any_of(mycolnames)) %>% slice_sample(n = 20) %>% as.data.frame()
profiles_tex5 %>%
filter(TEKTURSUM < 99) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
)
) %>%
ggplot(aes(x = TEKTURSUM, y = tminsum)) + geom_point()
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0,
.default = NA
),
CaCO3 = CACO3
) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
),
clay = case_when(
TEKTURSUM >= 90 ~ LER * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ LER * 100 / (not_SOM_CaCO3),
.default = LER
),
silt = case_when(
TEKTURSUM >= 90 ~ SILT * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ SILT * 100 / (not_SOM_CaCO3),
.default = SILT
),
fsand_raw = sum(GRVSILT, S63, S125, na.rm = TRUE),
fine_sand = case_when(
TEKTURSUM >= 90 ~ fsand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ fsand_raw * 100 / (not_SOM_CaCO3),
.default = fsand_raw
),
csand_raw = sum(S200, S500, na.rm = TRUE),
coarse_sand = case_when(
TEKTURSUM >= 90 ~ csand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ csand_raw * 100 / (not_SOM_CaCO3),
.default = csand_raw
)
)%>%
ungroup() %>%
select(any_of(mycolnames)) %>% slice_sample(n = 20) %>% as.data.frame()
sum(is.na(c(1, NA)))
is.na(1, NA)
sum(1, 1, 2)
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0,
.default = NA
),
CaCO3 = CACO3
) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
),
clay = case_when(
TEKTURSUM >= 90 ~ LER * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ LER * 100 / (not_SOM_CaCO3),
.default = LER
),
silt = case_when(
TEKTURSUM >= 90 ~ SILT * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ SILT * 100 / (not_SOM_CaCO3),
.default = SILT
),
fsand_raw = case_when(
sum(!is.na(c_across(GRVSILT:S125))) > 0 ~ sum(GRVSILT, S63, S125, na.rm = TRUE),
.default = NA
),
fine_sand = case_when(
TEKTURSUM >= 90 ~ fsand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ fsand_raw * 100 / (not_SOM_CaCO3),
.default = fsand_raw
),
csand_raw = case_when(
sum(!is.na(c_across(S200:S500))) > 0 ~ sum(S200, S500, na.rm = TRUE),
.default = NA
),
coarse_sand = case_when(
TEKTURSUM >= 90 ~ csand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ csand_raw * 100 / (not_SOM_CaCO3),
.default = csand_raw
)
)%>%
ungroup() %>%
select(any_of(mycolnames)) %>% slice_sample(n = 20) %>% as.data.frame()
plot(profiles_tex5$VOLVGT)
plot(profiles_tex5$PHCACL2)
plot(profiles_tex5$PHKCL)
seges
SEGES
profiles_tex5 %>%
mutate(
db = "Profile database",
ID_old = paste0(PROFILNR, "_", HORISONTNR, "_", HORISONTPR),
upper = PRFRA,
lower = PRTIL,
SOC = case_when(
!is.na(HUMUS) ~ HUMUS*0.587,
is.na(HUMUS) & is.na(CACO3) ~ `TOTAL KULSTOF`,
is.na(HUMUS) & CACO3 == 0 ~ `TOTAL KULSTOF`,
.default = NA
),
SOM_removed = case_when(
HUMUS >= 5 ~ 1,
HUMUS < 5 ~ 0,
.default = NA
),
CaCO3 = CACO3,
BD = VOLVGT,
pH = PHCACL2,
N = TOTALN
) %>%
rowwise() %>%
mutate(
tminsum = sum(LER, SILT, GRVSILT, S63, S125, S200, S500, na.rm = TRUE),
not_SOM_CaCO3 = case_when(
!is.na(sum(HUMUS, CACO3)) ~ 100 - (HUMUS + CACO3),
!is.na(HUMUS) & is.na(CACO3) ~ 100 - HUMUS,
is.na(HUMUS) & !is.na(CACO3) ~ 100 - CACO3,
.default = NA
),
clay = case_when(
TEKTURSUM >= 90 ~ LER * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ LER * 100 / (not_SOM_CaCO3),
.default = LER
),
silt = case_when(
TEKTURSUM >= 90 ~ SILT * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ SILT * 100 / (not_SOM_CaCO3),
.default = SILT
),
fsand_raw = case_when(
sum(!is.na(c_across(GRVSILT:S125))) > 0 ~ sum(GRVSILT, S63, S125, na.rm = TRUE),
.default = NA
),
fine_sand = case_when(
TEKTURSUM >= 90 ~ fsand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ fsand_raw * 100 / (not_SOM_CaCO3),
.default = fsand_raw
),
csand_raw = case_when(
sum(!is.na(c_across(S200:S500))) > 0 ~ sum(S200, S500, na.rm = TRUE),
.default = NA
),
coarse_sand = case_when(
TEKTURSUM >= 90 ~ csand_raw * 100 / (tminsum),
TEKTURSUM < 90 & !is.na(not_SOM_CaCO3) ~ csand_raw * 100 / (not_SOM_CaCO3),
.default = csand_raw
)
)%>%
ungroup() %>%
select(any_of(mycolnames)) %>% slice_sample(n = 20) %>% as.data.frame()
sinks4
sinks3
sinks3 %>% as.data.frame()
sinks2
sinks2 %>% as.data.frame()
plot(sinks2$Masse)
plot(sinks2$Masse, sinks2$TOC2)
plot(sinks2$Masse, sinks2$Torstof)
plot(sinks2$Masse, sinks2$ProLang)
plot(sinks2$Masse, sinks2$KomLang)
plot(sinks2$ProLang, sinks2$KomLang)
plot(sinks2$Masse/sinks2$KomLang, sinks2$TOC2)
plot(sinks2$Masse*sinks2$Torstof*0.01/sinks2$KomLang, sinks2$TOC2)
