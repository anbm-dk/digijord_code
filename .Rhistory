obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.01, na.rm = TRUE, names = FALSE),
to = quantile(
obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.99, na.rm = TRUE, names = FALSE),
length.out = 65
)
pgrid <- expand.grid(
upper = seq(0, 195, 5),
filled_s1_baresoil_composite_vh_8_days = xvalues
) %>%
mutate(lower = upper + 5)
plotratio <- ((max(pgrid[, 2]) - min(pgrid[, 2])) / 200) * (40 / 65)
pdp_outlist_depth <- list()
i <- 1
dir_boot_models_raw_i <- dir_boot_models_raw %>%
paste0(., fractions[i], "/")
# bootr <- 1
for (bootr in 1:5) {
model_ib <- models_boot_files[[i]][bootr] %>% readRDS()
p1xv <- pdp::partial(
model_ib,
pred.var = c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days"),
pred.grid = pgrid,
type = "regression"
)
p1xv %>%
mutate(Depth = (upper + lower)/2)
p1xv$Fraction <- fractions[i]
pdp_outlist_depth[[length(pdp_outlist_depth) + 1]] <- p1xv
}
pdp_outlist_depth
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat))
pdp_depth_mean <- pdp_depth_raw %>%
mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat))
pdp_depth_mean %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean
library(xgboost)
library(pdp)
dir_boot_models_raw <- dir_boot %>%
paste0(., "/models_raw/")
xvalues <- seq(
from = quantile(
obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.01, na.rm = TRUE, names = FALSE),
to = quantile(
obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.99, na.rm = TRUE, names = FALSE),
length.out = 32
)
pgrid <- expand.grid(
upper = seq(0, 190, 10),
filled_s1_baresoil_composite_vh_8_days = xvalues
) %>%
mutate(lower = upper + 10)
plotratio <- ((max(pgrid[, 2]) - min(pgrid[, 2])) / 200) * (20 / 32)
pdp_outlist_depth <- list()
i <- 1
dir_boot_models_raw_i <- dir_boot_models_raw %>%
paste0(., fractions[i], "/")
# bootr <- 1
for (bootr in 1:5) {
model_ib <- models_boot_files[[i]][bootr] %>% readRDS()
p1xv <- pdp::partial(
model_ib,
pred.var = c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days"),
pred.grid = pgrid,
type = "regression"
)
p1xv %<>%
mutate(Depth = (upper + lower)/2)
p1xv$Fraction <- fractions[i]
pdp_outlist_depth[[length(pdp_outlist_depth) + 1]] <- p1xv
print(paste(fractions[i], "model", bootr))
}
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat))
pdp_depth_mean %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio, expand = FALSE) +
scale_y_reverse()
pdp_depth_mean %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
plot(pdp_depth_mean$filled_s1_baresoil_composite_vh_8_days)
plot(pdp_depth_mean$Depth)
?geom_tile
plotratio
32*20
pdp_depth_mean
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4)
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4)
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio) +
scale_y_reverse()
pdp_depth_mean
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4)
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_tile(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
?seq
xvalues
xvalues[1]
xvalues[2]
xvalues[3]
xvalues[4]
?geom_raster
pdp_depth_mean %>%
mutate(S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
unique(pdp_depth_mean$filled_s1_baresoil_composite_vh_8_days)
unique(pdp_depth_mean$filled_s1_baresoil_composite_vh_8_days) %>% length()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 4)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 2)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean
str(xvalues)
str(pgrid)
pgrid
pdp_depth_mean
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
)
pgrid$filled_s1_baresoil_composite_vh_8_days
pdp_depth_mean
pgrid
pdp_depth_mean %>%
arrange(-filled_s1_baresoil_composite_vh_8_days)
pdp_depth_mean %<>%
arrange(filled_s1_baresoil_composite_vh_8_days)
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %<>%
arrange(filled_s1_baresoil_composite_vh_8_days)
pdp_depth_mean$filled_s1_baresoil_composite_vh_8_days <- pgrid$filled_s1_baresoil_composite_vh_8_days
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 2)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = round(filled_s1_baresoil_composite_vh_8_days/10^4, 3)
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = filled_s1_baresoil_composite_vh_8_days, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
# coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio/10^4) +
scale_y_reverse()
pdp_depth_mean %>%
mutate(
S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio/10^4, expand = FALSE) +
scale_y_reverse()
library(xgboost)
library(pdp)
dir_boot_models_raw <- dir_boot %>%
paste0(., "/models_raw/")
xvalues <- seq(
from = quantile(
obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.01, na.rm = TRUE, names = FALSE),
to = quantile(
obs$filled_s1_baresoil_composite_vh_8_days,
probs = 0.99, na.rm = TRUE, names = FALSE),
length.out = 32
)
pgrid <- expand.grid(
upper = seq(0, 190, 10),
filled_s1_baresoil_composite_vh_8_days = xvalues
) %>%
mutate(lower = upper + 10)
plotratio <- ((max(pgrid[, 2]) - min(pgrid[, 2])) / 200) * (20 / 32)
pdp_outlist_depth <- list()
for (i in frac_ind_predict) {
for (bootr in 1:nboot) {
model_ib <- models_boot_files[[i]][bootr] %>% readRDS()
p1xv <- pdp::partial(
model_ib,
pred.var = c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days"),
pred.grid = pgrid,
type = "regression"
)
p1xv %<>%
mutate(Depth = (upper + lower)/2)
p1xv$Fraction <- fractions[i]
pdp_outlist_depth[[length(pdp_outlist_depth) + 1]] <- p1xv
print(paste(fractions[i], "model", bootr))
}
}
pdp_depth_raw <- pdp_outlist_depth %>%
bind_rows()
pdp_depth_mean <- pdp_depth_raw %>%
# mutate(Depth = (upper + lower)/2) %>%
group_by(Depth, filled_s1_baresoil_composite_vh_8_days, Fraction) %>%
summarise(yhat = mean(yhat, na.rm = TRUE))
pdp_depth_mean %<>%
arrange(filled_s1_baresoil_composite_vh_8_days)
pdp_depth_mean$filled_s1_baresoil_composite_vh_8_days <- pgrid$filled_s1_baresoil_composite_vh_8_days
pdp_depth_mean %>%
mutate(
S1_VH_spring = filled_s1_baresoil_composite_vh_8_days/10^4
) %>%
filter(Fraction == "clay") %>%
ggplot() +
geom_raster(aes(x = S1_VH_spring, y = Depth, fill = yhat)) +
scale_fill_viridis_c() +
coord_fixed(ratio = plotratio/10^4, expand = FALSE) +
scale_y_reverse()
names_model_i <- varImp(model_ib)$importance %>% rownames()
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %in% names_model_i
?not
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>% %in% names_model_i
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>% is_in(names_model_i)
ok1 <- c("upper", "lower") %>%
is_in(names_model_i) %>%
is_greater_than(0)
c("upper", "lower") %>%
is_in(names_model_i) %>%
sum() %>%
is_greater_than(0)
ok1 <- c("upper", "lower") %>%
is_in(names_model_i) %>%
sum() %>%
is_greater_than(0)
ok2 <- "filled_s1_baresoil_composite_vh_8_days" %>%
is_in(names_model_i) %>%
add(ok1) %>%
is_greater_than(1)
"filled_s1_baresoil_composite_vh_8_days" %>%
is_in(names_model_i)
"filled_s1_baresoil_composite_vh_8_days" %>%
is_in(names_model_i) %>%
add(ok1)
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>%
extract(. is_in(names_model_i))
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>%
extract(is_in(names_model_i))
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>%
extract(. %>% is_in(names_model_i))
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>%
extract(. %in% names_model_i)
?extract
c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days") %>%
tidyr::extract(. %in% names_model_i)
predvars_full <- c("upper", "lower", "filled_s1_baresoil_composite_vh_8_days")
predvars_full %>% extract(. %in% )
predvars_full %>% extract(. %in% names_model_i)
predvars_full %>% extract(1)
predvars_full %>% extract2(1)
predvars_full %>% extract2(. %in% names_model_i)
predvars_full %>% extract2(predvars_full %in% names_model_i)
predvars_full %>% extract(predvars_full %in% names_model_i)
predvars_full %>% magrittr::extract(predvars_full %in% names_model_i)
predvars_full %>% magrittr::extract(. %in% names_model_i)
p1xv2 <- pdp::partial(
model_ib,
pred.var = c("upper", "lower"),
pred.grid = pgrid,
type = "regression"
)
pgrid
predvars_ib <- predvars_full %>%
magrittr::extract(. %in% names_model_i)
pgrid %>% select(any_of(predvars_ib))
pgrid_ib <- pgrid %>% select(any_of(predvars_ib))
p1xv2 <- pdp::partial(
model_ib,
pred.var = predvars_ib,
pred.grid = pgrid_ib,
type = "regression"
)
p1xv2
p1xv2 <- pdp::partial(
model_ib,
pred.var = predvars_ib,
pred.grid = pgrid,
type = "regression"
)
p1xv2 %>% mutate({if("bla" %in% names(.)) bla else NULL} = 4)
p1xv2 %>% mutate({if("bla" %in% names(.)) bla = 4})
p1xv2 %>% mutate({if("bla" !%in% names(.)) bla = 4})
p1xv2 %>% mutate({if(!("bla" !%in% names(.))) bla = 4})
p1xv2 %>% mutate({if(("bla" !%in% names(.))) NULL else bla = 4})
p1xv2 %>% mutate({if(("bla" %in% names(.))) NULL else bla = 4})
p1xv2 %>% mutate({if(("bla" %in% names(.))) NULL else (bla = 4)})
?mutate_at
?add_column
p1xv2 %>% add_column(!!!pgrid[setdiff(names(pgrid), names(p1cv2))])
library(tibble)
p1xv2 %>% add_column(!!!pgrid[setdiff(names(pgrid), names(p1cv2))])
p1xv2 %>% add_column(!!!pgrid[setdiff(names(pgrid), names(p1xv2))])
p1xv3 <- p1xv2 %>% add_column(!!!pgrid[setdiff(names(pgrid), names(p1xv2))])
bind_rows(p1xv3, pdp_outlist_depth[[1]])
setdiff(names(pgrid), names(p1xv))
setdiff(names(pgrid), names(p1xv3))
setdiff(names(pgrid), names(p1xv2))
?setdiff
p1xv2 %>% add_column(!!!pgrid[setdiff(names(pgrid), names(.))])
p1xv
p1xv2
p1xv3
p1xv2 %>% dd_column(
!!!pgrid[setdiff(names(pgrid), names(.))]
) %>%
mutate(
Depth = (upper + lower)/2,
Fraction = fractions[i]
)
p1xv2 %>% add_column(
!!!pgrid[setdiff(names(pgrid), names(.))]
) %>%
mutate(
Depth = (upper + lower)/2,
Fraction = fractions[i]
)
?!!!
()
